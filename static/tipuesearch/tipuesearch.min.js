!function(e){e.fn.tipuesearch=function(t){var s=e.extend({contentLocation:"tipuesearch_content.json",contextBuffer:60,contextLength:60,contextStart:90,debug:!1,descriptiveWords:25,highlightTerms:!0,liveContent:"*",liveDescription:"*",minimumLength:1,mode:"static",newWindow:!1,show:9,showContext:!0,showRelated:!0,showTime:!0,showTitleCount:!0,showURL:!0,wholeWords:!1},t);return this.each(function(){function t(e){var t=location.search,s=(new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t)||[,""])[1].replace(/\+/g,"%20");try{s=decodeURIComponent(s)}catch(e){s=unescape(s)}return s||null}function i(t,c){var n="",o=!1,l=!1,p=!0,_=0;found=[];var u=e("#tipue_search_input").val(),d=u.toLowerCase();((d=e.trim(d)).match('^"')&&d.match('"$')||d.match("^'")&&d.match("'$")||d.match("^“")&&d.match("”$")||d.match("^‘")&&d.match("’$")||d.match("^「")&&d.match("」$"))&&(p=!1);var g=d.split(" ");if(p){d="";for(m=0;m<g.length;m++){for(var f=!0,v=0;v<tipuesearch_stop_words.length;v++)g[m]==tipuesearch_stop_words[v]&&(f=!1,l=!0);f&&(d=d+" "+g[m])}g=(d=e.trim(d)).split(" ")}else d=d.substring(1,d.length-1);if(d.length>=s.minimumLength){if(p){if(c){for(var w=d,m=0;m<g.length;m++)for(v=0;v<tipuesearch_replace.words.length;v++)g[m]==tipuesearch_replace.words[v].word&&(d=d.replace(g[m],tipuesearch_replace.words[v].replace_with),o=!0);g=d.split(" ")}for(var x=d,m=0;m<g.length;m++)for(v=0;v<tipuesearch_stem.words.length;v++)g[m]==tipuesearch_stem.words[v].word&&(x=x+" "+tipuesearch_stem.words[v].stem);g=x.split(" ");for(m=0;m<a.pages.length;m++){for(var b=0,L=a.pages[m].text,v=0;v<g.length;v++){if(s.wholeWords)T=new RegExp("\\b"+g[v]+"\\b","gi");else T=new RegExp(g[v],"gi");if(-1!=a.pages[m].title.search(T)&&(b+=20*(C=a.pages[m].title.match(T).length)),-1!=a.pages[m].text.search(T)&&(b+=20*(C=a.pages[m].text.match(T).length)),-1!=a.pages[m].tags.search(T)&&(b+=10*(C=a.pages[m].tags.match(T).length)),-1!=a.pages[m].url.search(T)&&(b+=20),0!=b)for(R=0;R<tipuesearch_weight.weight.length;R++)a.pages[m].url==tipuesearch_weight.weight[R].url&&(b+=tipuesearch_weight.weight[R].score);g[v].match("^-")&&(T=new RegExp(g[v].substring(1),"i"),-1==a.pages[m].title.search(T)&&-1==a.pages[m].text.search(T)&&-1==a.pages[m].tags.search(T)||(b=0))}0!=b&&(found.push({score:b,title:a.pages[m].title,desc:L,url:a.pages[m].url}),_++)}}else for(m=0;m<a.pages.length;m++){var b=0,L=a.pages[m].text,T=new RegExp(d,"gi");if(-1!=a.pages[m].title.search(T)&&(b+=20*(C=a.pages[m].title.match(T).length)),-1!=a.pages[m].text.search(T)&&(b+=20*(C=a.pages[m].text.match(T).length)),-1!=a.pages[m].tags.search(T)){var C=a.pages[m].tags.match(T).length;b+=10*C}if(-1!=a.pages[m].url.search(T)&&(b+=20),0!=b)for(var R=0;R<tipuesearch_weight.weight.length;R++)a.pages[m].url==tipuesearch_weight.weight[R].url&&(b+=tipuesearch_weight.weight[R].score);0!=b&&(found.push({score:b,title:a.pages[m].title,desc:L,url:a.pages[m].url}),_++)}if(0!=_){if(s.showTitleCount&&0==r){var E=document.title;document.title="("+_+") "+E,r++}o&&(n+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+d+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+w+"</a></div>"),1==_?n+='<div id="tipue_search_results_count">'+tipuesearch_string_4:(c_c=_.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),n+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5),s.showTime&&(n+=" ("+(((new Date).getTime()-startTimer)/1e3).toFixed(2)+" "+tipuesearch_string_14+")",s.showTime=!1),n+="</div>",found.sort(function(e,t){return t.score-e.score});for(var k=0,m=0;m<found.length;m++){if(k>=t&&k<s.show+t){if(n+='<div class="tipue_search_content_title"><a href="'+found[m].url+'"'+h+">"+found[m].title+"</a></div>",s.debug&&(n+='<div class="tipue_search_content_debug">Score: '+found[m].score+"</div>"),s.showURL){var $=found[m].url.toLowerCase();0==$.indexOf("http://")&&($=$.slice(7)),n+='<div class="tipue_search_content_url"><a href="'+found[m].url+'"'+h+">"+$+"</a></div>"}if(found[m].desc){var y=found[m].desc;if(s.showContext){g=d.split(" ");var W=found[m].desc.toLowerCase().indexOf(g[0]);if(W>s.contextStart){var O=y.substr(W-s.contextBuffer),S=O.indexOf(" ");O=y.substr(W-s.contextBuffer+S),(O=e.trim(O)).length>s.contextLength&&(y="... "+O)}}if(p){g=d.split(" ");for(v=0;v<g.length;v++)if(s.highlightTerms){j=new RegExp("("+g[v]+")","gi");y=y.replace(j,"<h0011>$1<h0012>")}}else if(s.highlightTerms){var j=new RegExp("("+d+")","gi");y=y.replace(j,'<span class="tipue_search_content_bold">$1</span>')}var q="",B=y.split(" ");if(B.length<s.descriptiveWords)q=y;else for(v=0;v<s.descriptiveWords;v++)q+=B[v]+" ";"."!=(q=e.trim(q)).charAt(q.length-1)&&(q+=" ..."),n+='<div class="tipue_search_content_text">'+(q=(q=q.replace(/h0011/g,'span class="tipue_search_content_bold"')).replace(/h0012/g,"/span"))+"</div>"}}k++}if(s.showRelated&&p){v=0;for(m=0;m<tipuesearch_related.searches.length;m++)d==tipuesearch_related.searches[m].search&&(o&&(u=d),v||(n+='<div class="tipue_search_related_title">'+tipuesearch_string_15+' <span class="tipue_search_related_bold">'+u+'</span></div><div class="tipue_search_related_cols">'),n+='<div class="tipue_search_related_text"><a class="tipue_search_related" id="'+tipuesearch_related.searches[m].related+'">',tipuesearch_related.searches[m].before&&(n+='<span class="tipue_search_related_before">'+tipuesearch_related.searches[m].before+"</span> "),n+=tipuesearch_related.searches[m].related,tipuesearch_related.searches[m].after&&(n+=' <span class="tipue_search_related_after">'+tipuesearch_related.searches[m].after+"</span>"),n+="</a></div>",v++);v&&(n+="</div>")}if(_>s.show){var D=Math.ceil(_/s.show),H=t/s.show;if(n+='<nav><div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',t>0&&(n+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="b" id="'+(t-s.show)+"_"+c+'">'+tipuesearch_string_6+"</a></li>"),H<=2){var M=D;D>3&&(M=3);for(v=0;v<M;v++)n+=v==H?'<li class="current" role="navigation">'+(v+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+v*s.show+"_"+c+'">'+(v+1)+"</a></li>"}else{(M=H+2)>D&&(M=D);for(v=H-1;v<M;v++)n+=v==H?'<li class="current" role="navigation">'+(v+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+v*s.show+"_"+c+'">'+(v+1)+"</a></li>"}H+1!=D&&(n+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="m" id="'+(t+s.show)+"_"+c+'">'+tipuesearch_string_7+"</a></li>"),n+="</ul></div></nav>"}}else n+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else l?n+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(n+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",1==s.minimumLength?n+='<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":n+='<div id="tipue_search_warning">'+tipuesearch_string_12+" "+s.minimumLength+" "+tipuesearch_string_13+"</div>");e("#tipue_search_content").html(n),e("#tipue_search_replaced").click(function(){i(0,!1)}),e(".tipue_search_related").click(function(){e("#tipue_search_input").val(e(this).attr("id")),i(0,!0)}),e(".tipue_search_foot_box").click(function(){var t=e(this).attr("id").split("_");i(parseInt(t[0]),t[1])})}var a={pages:[]},r=0;e("#tipue_search_content").hide().html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>').show();var c=new XMLHttpRequest;if("live"==s.mode)for(var n=0;n<tipuesearch_pages.length;n++)c.open("GET",tipuesearch_pages[n],!1),c.onload=function(){if(200===c.status){var t=c.responseHTML,i=e(s.liveContent,t).text();i=i.replace(/\s+/g," ");var r=e(s.liveDescription,t).text();r=r.replace(/\s+/g," ");var h=t.toLowerCase().indexOf("<title>"),o=t.toLowerCase().indexOf("</title>",h+7);if(-1!=h&&-1!=o)l=t.slice(h+7,o);else var l=tipuesearch_string_1;a.pages.push({title:l,text:r,tags:i,url:tipuesearch_pages[n]})}},c.send();"json"==s.mode&&(c.open("GET",s.contentLocation,!1),c.setRequestHeader("Content-Type","application/json"),c.onload=function(){if(200===c.status){var t=JSON.parse(c.responseText);a=e.extend({},t)}},c.send()),"static"==s.mode&&(a=e.extend({},tipuesearch));var h="";s.newWindow&&(h=' target="_blank"'),t("q")&&(e("#tipue_search_input").val(t("q")),i(0,!0)),e(this).keyup(function(e){"13"==e.keyCode&&i(0,!0)})})}}(jQuery);