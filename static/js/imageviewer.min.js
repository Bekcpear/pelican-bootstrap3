(function(a,f,g){'use strict';function i(u,v,w,z){return u/=z,u--,-w*(u*u*u*u-1)+v}function j(u){return u.complete&&('undefined'==typeof u.naturalWidth||0!==u.naturalWidth)}function k(u,v){this.container=u,this.onMove=v.onMove||m,this.sliderId=v.sliderId||'slider'+Math.ceil(1e6*Math.random())}function l(u){var v=this,w=a('#iv-container');v._fullPage=!0,v.container=w,u=v.options=a.extend({},l.defaults,u),v.zoomValue=100,w.find('.iv-image-view').length||w.prepend(s),w.addClass('iv-container'),'static'==w.css('position')&&w.css('position','relative'),v.imageWrap=w.find('.iv-image-wrap'),v._viewerId='iv'+Math.floor(1e6*Math.random())}var m=function(){},n=a('body'),o=a(f),p=a(g);(function(){for(var u=0,v=['ms','moz','webkit','o'],w=0;w<v.length&&!f.requestAnimationFrame;++w)f.requestAnimationFrame=f[v[w]+'RequestAnimationFrame'],f.cancelAnimationFrame=f[v[w]+'CancelAnimationFrame']||f[v[w]+'CancelRequestAnimationFrame'];f.requestAnimationFrame||(f.requestAnimationFrame=function(z){var B=new Date().getTime(),C=Math.max(0,16-(B-u)),D=f.setTimeout(function(){z(B+C)},C);return u=B+C,D}),f.cancelAnimationFrame||(f.cancelAnimationFrame=function(z){clearTimeout(z)})})();var s='<div class="iv-loader"></div><div class="iv-image-view" ><div class="iv-image-wrap" ></div></div>';a(function(){n.length||(n=a('body')),n.append('<div id="iv-container">'+s+'<div class="iv-close"></div><div>')}),k.prototype.init=function(){var u=this,v=this.container,w='.'+this.sliderId;return this.container.on('touchstart'+w+' mousedown'+w,function(z){z.preventDefault();var A=('touchstart'==z.type?'touchmove':'mousemove')+w,B=('touchstart'==z.type?'touchend':'mouseup')+w,C=z.originalEvent,D=C.clientX||(C.touches?C.touches[0].clientX:0),E=C.clientY||(C.touches?C.touches[0].clientY:0),F=D,G=E,H=Date.now(),I=Date.now(),J=0,K=function(M){M.preventDefault(),C=M.originalEvent;var N=C.clientX||(C.touches?C.touches[0].clientX:F),O=C.clientY||(C.touches?C.touches[0].clientY:G),P=N-F,Q=O-G;I=Date.now(),100<I-H&&(D=F,E=G,J=0);var R=Math.abs(N-D)/Math.abs(O-E);Q=5<R||3>J?0:Q,P=0.3>R||3>J?0:P,u.onMove(M,{dx:P,dy:Q,mx:N,my:O}),F=N,G=O,H=Date.now(),J++},L=function(){p.off(A,K),p.off(B,L)};p.on(A,K),p.on(B,L)}),this},l.prototype={constructor:l,_init:function(){var u=this,v=u.options,w=!1,z=this.container,A='.'+u._viewerId,B=this.imageWrap,C=u._imageSlider=new k(B,{sliderId:u._viewerId,onMove:function(L,M){if(u.loaded&&!w){this.currentPos=M;var N=parseFloat(u.currentImg.css('left'))+M.dx,O=parseFloat(u.currentImg.css('top'))+M.dy;u.currentImg.css({left:N+'px',top:O+'px'})}}}).init(),D=0;z.on('mousewheel'+A+' DOMMouseScroll'+A,function(L){if(v.zoomOnMouseWheel&&u.loaded){u._clearFrames();var M=Math.max(-1,Math.min(1,L.originalEvent.wheelDelta||-L.originalEvent.detail)),N=u.zoomValue*(100+M*15)/100;if(N>=v.minZoom&&N<=v.maxZoom?D=0:D+=Math.abs(M),!(D>5)){L.preventDefault();var O=z.offset(),P=(L.pageX||L.originalEvent.pageX)-O.left,Q=(L.pageY||L.originalEvent.pageY)-O.top;u.zoom(N,{x:P,y:Q})}}}),B.on('touchstart'+A,function(L){if(u.loaded){var M=L.originalEvent.touches[0],N=L.originalEvent.touches[1];if(M&&N){w=!0;var O=z.offset(),P=Math.sqrt(Math.pow(N.pageX-M.pageX,2)+Math.pow(N.pageY-M.pageY,2)),Q=u.zoomValue,R={x:(N.pageX+M.pageX)/2-O.left,y:(N.pageY+M.pageY)/2-O.top},S=function(U){U.preventDefault();var V=U.originalEvent.touches[0],W=U.originalEvent.touches[1],X=Math.sqrt(Math.pow(W.pageX-V.pageX,2)+Math.pow(W.pageY-V.pageY,2));u.zoom(Q+(X-P)/2,R)},T=function(){p.off('touchmove',S),p.off('touchend',T),w=!1};p.on('touchmove',S),p.on('touchend',T)}}});var G,E=0,F=0;B.on('click'+A,function(L){return E=Date.now(),G={x:L.pageX,y:L.pageY},300>E-F&&50>Math.abs(L.pageX-G.x)&&50>Math.abs(L.pageY-G.y)?(u.zoomValue==v.zoomValue?2<u.imageDim.sw/u.imageDim.w?u.zoom(100*(u.imageDim.sw/u.imageDim.w)):u.zoom(200):u.resetZoom(),void(F=0)):void(F=Date.now())});var H=Date.now(),I=Date.now(),J=0,K=1;a(g).on('keydown'+A+' keyup'+A,function(L){if('block'===a('#iv-container').css('display')&&(37<=L.keyCode&&40>=L.keyCode||27===L.keyCode||'+'===L.key||'-'===L.key))if(L.preventDefault(),I=Date.now(),60>I-H&&L.keyCode===J&&L.altKey?K++:K=1,H=Date.now(),J=L.keyCode,K=L.altKey?Math.min(K,5):10*K,K=L.ctrlKey?10*K:K,'keydown'===L.type){switch(L.keyCode){case 37:u._imageSlider.onMove(null,{dx:-1*K,dy:0});break;case 38:u._imageSlider.onMove(null,{dx:0,dy:-1*K});break;case 39:u._imageSlider.onMove(null,{dx:1*K,dy:0});break;case 40:u._imageSlider.onMove(null,{dx:0,dy:1*K});}switch(L.key){case'+':L.ctrlKey?u.zoom(1.5*u.zoomValue):u.zoom(u.zoomValue*(100+K)/100);break;case'-':L.ctrlKey?u.zoom(0.5*u.zoomValue):u.zoom(u.zoomValue*(100-K)/100);}}else'keyup'===L.type&&27===L.keyCode&&u.hide()}),v.refreshOnResize&&o.on('resize'+A,function(){u.refresh()}),u._fullPage&&(z.on('touchmove'+A+' mousewheel'+A+' DOMMouseScroll'+A,function(L){L.preventDefault()}),z.find('.iv-close').on('click'+A,function(){u.hide()}),z.find('.iv-image-view').on('click'+A,function(){a('.iv-large-image').is(':hover')||u.hide()}))},zoom:function(u,v){function w(){G++,20>G&&(z._zoomFrame=requestAnimationFrame(w));var M=i(G,B,u-B,20),N=M/B,O=z.imageDim.w*M/100,P=z.imageDim.h*M/100,Q=-((v.x-E)*N-v.x),R=-((v.y-F)*N-v.y);u<B&&100<=u?(Q=Math.min(Q,I),R=Math.min(R,J),Q+O<K&&(Q=K-O),R+P<L&&(R=L-P)):u>B&&100>=u&&(Q=(D.w-O)/2,R=(D.h-P)/2),C.css({height:P+'px',width:O+'px',left:Q+'px',top:R+'px'}),z.zoomValue=M}u=Math.round(Math.max(this.options.minZoom,u)),u=Math.min(this.options.maxZoom,u),v=v||{x:this.containerDim.w/2,y:this.containerDim.h/2};var z=this,A=this.options.maxZoom,B=this.zoomValue,C=this.currentImg,D=this.containerDim,E=parseFloat(C.css('left')),F=parseFloat(C.css('top'));this.zoomT0=this.zoomT0?this.zoomT0:0,this.zoomT1=Date.now(),this.zoomC=0,100>this.zoomT1-this.zoomT0&&(100>=u&&100<=B||100<=u&&100>=B)&&10>this.zoomC?(u=100,this.zoomC++):this.zoomC=0,this.zoomT0=Date.now(),z._clearFrames();var G=0,D=z.containerDim,H=z.imageDim,I=(D.w-H.w)/2,J=(D.h-H.h)/2,K=D.w-I,L=D.h-J;w()},_clearFrames:function(){cancelAnimationFrame(this._zoomFrame)},resetZoom:function(){this.zoom(this.options.zoomValue)},_calculateDimensions:function(){var u=this,v=u.currentImg,w=u.container,z=v.width(),A=v.height(),B=w.width(),C=w.height();u.containerDim={w:B,h:C};var D,E,F=z/A;D=z>A&&C>=B||F*C>B?B:F*C,D=(z>A&&C>=B||F*C>B)&&z<B?z:D,E=D/F,u.imageDim={w:D,h:E,sw:z,sh:A},v.css({width:D+'px',height:E+'px',left:(B-D)/2+'px',top:(C-E)/2+'px'}),u.options.maxZoom=z>D?z/D*u.options.maxZoom:u.options.maxZoom},refresh:function(){this.loaded&&(this._calculateDimensions(),this.resetZoom())},show:function(u,v=''){this._fullPage&&(this.container.show(),u&&this.load(u,v))},hide:function(){this._fullPage&&this.container.hide()},options:function(u,v){return v?void(this.options[u]=v):this.options[u]},destroy:function(){var w='.'+this._viewerId;return this._fullPage?(container.off(w),container.find('[class^="iv"]').off(w)):this.container.remove('[class^="iv"]'),o.off(w),null},load:function(u,v){function w(){z.loaded=!0,z.zoomValue=100,B.show(),z.refresh(),z.resetZoom(),A.find('.iv-loader').hide()}var z=this,A=this.container;A.find('.iv-large-image').remove(),this.imageWrap.prepend('<img class="iv-large-image" src="'+u+'" />'),v&&this.imageWrap.append('<img class="iv-large-image" src="'+v+'" />');var B=this.currentImg=this.container.find('.iv-large-image');z.loaded=!1,A.find('.iv-loader').show(),B.hide(),j(B[0])?w():a(B[0]).on('load',w)}},l.defaults={zoomValue:100,minZoom:20,maxZoom:500,refreshOnResize:!0,zoomOnMouseWheel:!0},f.ImageViewer=function(u){var v=new l(u);return v._init(),v}})(window.jQuery,window,document);