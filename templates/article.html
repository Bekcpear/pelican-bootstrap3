{% extends "base.html" %}
{% set artlangname = dict(zh='zh-Hans', zht='zh-Hant', en='en-us') %}
{% block html_lang %}{{ artlangname[article.lang] }}{% endblock %}
  {% block title %}{{ article.title|striptags }} - {{ SITENAME }}{% endblock %}

  {% block meta %}
    {% if article.author %}
  <meta name="author" content="{{ article.author }}" />
    {% else %}
  <meta name="author" content="{{ AUTHOR }}" />
    {% endif %}
    {% if article.tags %}
  <meta name="keywords" content="{{ article.tags|join(',')|striptags }}" />
    {% endif %}
    {% if article.summary %}
  <meta name="description" content="{{ article.summary|striptags|escape }}" />
    {% endif %}
  {% endblock %}

  {% block opengraph %}
    {% if OPEN_GRAPH_FB_APP_ID %}
  <meta property="fb:app_id" content="{{ OPEN_GRAPH_FB_APP_ID }}"/>
    {% endif %}
  <meta property="og:site_name" content="{{ SITENAME }}" />
  <meta property="og:type" content="article"/>
  <meta property="og:title" content="{{ article.title|striptags|escape }}"/>
  <meta property="og:url" content="{{ SITEURL }}/{{ article.url }}"/>
  <meta property="og:description" content="{{ article.summary|striptags|escape }}"/>
  <meta property="article:published_time" content="{{ article.date.strftime("%Y-%m-%d") }}" />
    {% if article.category %}
  <meta property="article:section" content="{{ article.category }}" />
    {% endif %}
    {% for tag in article.tags %}
  <meta property="article:tag" content="{{ tag }}" />
    {% endfor %}
    {% if article.author %}
  <meta property="article:author" content="{{ article.author }}" />
    {% elif AUTHOR %}
  <meta property="article:author" content="{{ AUTHOR }}" />
    {% endif %}
    {% if article.og_image %}
  <meta property="og:image" content="{{ SITEURL }}/{{ article.og_image }}"/>
    {% elif OPEN_GRAPH_IMAGE %}
  <meta property="og:image" content="{{ SITEURL }}/{{ OPEN_GRAPH_IMAGE }}"/>
    {% else %}
  <meta property="og:image" content="{{ SITEURL }}/{{ article.slug }}.png"/>
    {% endif %}
  {% endblock %}

  {% block canonical_rel %}
  <link rel="canonical" href="{{ SITEURL }}/{{ article.url }}">
  {% endblock %}

          {% block breadcrumbs %}
            {% if DISPLAY_BREADCRUMBS %}
              {% if DISPLAY_CATEGORY_IN_BREADCRUMBS %}
          <ol class="breadcrumb">
            {# <li><a href="{{ SITEURL }}/" title="{{ SITENAME }}"><i class="fa fa-home"></i></a></li> #}
            <li><a href="{{ SITEURL }}/{{ article.category.url }}" title="{{ article.category }}">{{ article.category }}</a></li>
            <li class="active">{{ article.title }}</li>
          </ol>
              {% else %}
          <ol class="breadcrumb">
            <li><a href="{{ SITEURL }}/" title="{{ SITENAME }}"><i class="fa fa-home fa-lg"></i></a></li>
            <li class="active">{{ article.title }}</li>
          </ol>
              {% endif %}
            {% endif %}
          {% endblock %}

        {% block toc %}
        {% if article.toc %}
        <div class="panel panel-default affix-top hidden-xs hidden-sm" id="affix-toc">
          <div class="panel-heading">
            {% trans %}Table of Contents{% endtrans %}
          </div>
          <div class="panel-body">
            {{ article.toc }}
          </div>
        </div>
        {% endif %}
        {% endblock %}

          {% block content %}
          <section id="content" class="article-content">
            <article class="jumbotron">
              <header class="page-header panel-primary" id="article-header">
                <div class="panel-heading">
                  <h1>
                    {{ article.title }}
                    <a href="{{ SITEURL }}/{{ article.url }}"
                       rel="bookmark"
                       class="btn btn-primary btn-lg"
                       title="{% trans title=article.title|striptags %}Permalink to {{ title }}{% endtrans %}">
                       <i class="fa fa-link fa-invert"></i>
                    </a>
                  </h1>
                </div>
                <div class="panel-body">
                  {% include 'includes/article_info.html' %}
                </div>
              </header>

              <div class="license-desc">
              {% if ( not article.notoriginal) %}
                {%- if CC_LICENSE or CC_LICENSE_DERIVATIVES or CC_LICENSE_COMMERCIAL %}
                <div class="collapse" id="license-desc">
                  {% from 'includes/cc-license.html' import cc_license_mark %}
                  {{ cc_license_mark(cc_name=CC_LICENSE,derivatives=CC_LICENSE_DERIVATIVES,commercial=CC_LICENSE_COMMERCIAL,lang=DEFAULT_LANG,desc=True,attr_props={'title':article.title,'name':article.author if article else AUTHOR,'authorurl':SITEURL ~ '/about.html','arturl':SITEURL ~ '/' ~ article.url,'url':SITEURL}) }}
                </div>
                <a data-toggle="collapse" data-target="#license-desc" aria-expanded="false">{% trans %}License{% endtrans %}</a>
                {% endif %}
              {% endif %}
              </div>

              <div class="entry-content" id="article-content">
                {% if article.license %}
                <div class="add-license">
                  {{ article.license }}
                </div>
                {% endif %}
                {% if article.toc %}
                <div class="panel panel-default" id="article-toc">
                  <div class="panel-heading">
                    {% trans %}Table of Contents{% endtrans %}
                  </div>
                  <div class="panel-body">
                    {{ article.toc }}
                  </div>
                </div>
                {% endif %}
                {{ article.content }}
              </div>

              <div class="entry-content" id="source-content" style="display: none">
                {# <pre><code id="source-code">
                </code></pre> #}
                <div id="source-code"></div>
              </div>

              <div class="row hidden-print" id="prevnext">
                <div class="col-xs-12">
                  {% if article.prev_article %}
                  <a href="{{ SITEURL }}/{{article.prev_article.url}}">
                    <i class="fa fa-angle-left"></i><span class="icon-label">{{article.prev_article.title}}</span>
                  </a>
                  {% endif %}
                </div>
                <div class="col-xs-12">
                  {% if article.next_article %}
                  <a href="{{ SITEURL }}/{{article.next_article.url}}">
                    <span class="icon-label-left">{{article.next_article.title}}</span><i class="fa fa-angle-right"></i>
                  </a>
                  {% endif %}
                </div>
              </div>

              {% include 'includes/related-posts.html' %}
              {% include 'includes/addthis.html' %}
              {% include 'includes/comments.html' %}

            </article>
          </section>
          {% endblock %}

  {% block scripts %}
  <script>
    function getSourceCode(){
      var url = '{{SITEURL}}/{{article.slug}}.rst.html';
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url);
      xhr.onload = function() {
        if (xhr.status === 200) {
          $('#source-code').html(xhr.responseText)
        } else {
          $('#source-code').html("Get source code error from {{SITEURL}}/{{article.slug}}.rst.html.")
        }
      }
      xhr.send();
      $('#article-content').toggle();
      $('#source-content').toggle();
      $('#source-code').html("waitting..")
      return false;
    }
  </script>
  {% endblock %}
